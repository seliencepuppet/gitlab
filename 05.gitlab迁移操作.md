
当遇到以下需求，公司更换了新的gitlab服务器，需要把旧的gitlab迁移到新的服务器上面去，如何进行操作？

```shell
[root@zhangyz ~]# gitlab-rake gitlab:env:info

System information
System:
Current User:   git
Using RVM:      no
Ruby Version:   2.5.3p105
Gem Version:    2.7.6
Bundler Version:1.17.3
Rake Version:   12.3.2
Redis Version:  3.2.12
Git Version:    2.18.1
Sidekiq Version:5.2.5
Go Version:     unknown

GitLab information
Version:        11.10.4
Revision:       62c464651d2
Directory:      /opt/gitlab/embedded/service/gitlab-rails
DB Adapter:     PostgreSQL
DB Version:     9.6.11
URL:            http://192.168.99.235
HTTP Clone URL: http://192.168.99.235/some-group/some-project.git
SSH Clone URL:  git@192.168.99.235:some-group/some-project.git
Using LDAP:     no
Using Omniauth: yes
Omniauth Providers: 

GitLab Shell
Version:        9.0.0
Repository storage paths:
- default:      /var/opt/gitlab/git-data/repositories
GitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell
Git:            /opt/gitlab/embedded/bin/git
```

#### 02.备份原来旧的gitlab服务器上面的所有项目

```shell
[root@zhangyz ~]# gitlab-rake gitlab:backup:create RAILS_ENV=production
2019-11-12 14:21:41 +0800 -- Dumping database ... 
Dumping PostgreSQL database gitlabhq_production ... [DONE]
2019-11-12 14:21:45 +0800 -- done
2019-11-12 14:21:45 +0800 -- Dumping repositories ...
```

执行完成之后会有一个 .tar 结尾的打包文件这个打包文件就是备份好的项目，这个文件的存放路径在 /var/opt/gitlab/backups 目录下

<br/>

#### 03.将 xxx.tar 文件拷贝上传到新的gitlab服务器

```shell
[root@zhangyz ~]# scp -r xxx.tar root@192.168.1.1:/var/opt/gitlab/backups
```

#### 04.开始导入要恢复的项目, 导入将项目的时间戳写上即可

```shell
[root@zhangyz ~]# gitlab-rake gitlab:backup:restore RAILS_ENV=production BACKUP=12312412412
```
